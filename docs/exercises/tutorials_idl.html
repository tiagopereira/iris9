

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. IDL Tutorials &mdash; IRIS-9 Data Analysis Tutorials</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="IRIS-9 Data Analysis Tutorials" href="index.html"/>
        <link rel="next" title="4. Python Tutorials" href="tutorials_python.html"/>
        <link rel="prev" title="2. Tutorial preparation" href="tut_prep.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> IRIS-9 Data Analysis Tutorials</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tut_prep.html">2. Tutorial preparation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tut_prep.html#idl-setup">2.1. IDL Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_prep.html#python-setup">2.2. Python Setup</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. IDL Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#iris-xfiles">3.1. IRIS xfiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mg-ii-dopplergrams">3.2. Mg II Dopplergrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crispex">3.3. CRISPEX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials_python.html">4. Python Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials_python.html#Mg-II-Dopplergrams">4.1. Mg II Dopplergrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials_python.html#Flare-4-step-raster:-SJI-and-spectrograph">4.2. Flare 4-step raster: SJI and spectrograph</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">IRIS-9 Data Analysis Tutorials</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>3. IDL Tutorials</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="idl-tutorials">
<h1>3. IDL Tutorials<a class="headerlink" href="#idl-tutorials" title="Permalink to this headline">¶</a></h1>
<div class="section" id="iris-xfiles">
<span id="xfiles-tut"></span><h2>3.1. IRIS xfiles<a class="headerlink" href="#iris-xfiles" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will guide you step-by-step into some features of <code class="docutils literal notranslate"><span class="pre">iris_xfiles</span></code>, a quicklook tool. Go to the directory with the IRIS data, start IDL as described above, and then start <code class="docutils literal notranslate"><span class="pre">iris_xfiles</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">iris_xfiles</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important that you start IDL on the <code class="docutils literal notranslate"><span class="pre">~/iris9/</span></code> directory, and from the command line. Not doing so will result in files you create later being saved in a different directory, and some of the instructions here will not be correct. If you do not run IDL from the <code class="docutils literal notranslate"><span class="pre">~/iris9/</span></code> directory, make note of where you run it from, so you can find your files later on.</p>
</div>
<p>In the middle panel, next to <strong>Search Directory:</strong> press <strong>Change</strong>. Then navigate to the directory <code class="docutils literal notranslate"><span class="pre">~/iris9</span></code>, press <strong>OK</strong> when this directory is selected. Notice that <strong>Search Pattern</strong> changed to <strong>free search</strong>. Then change <strong>Start Time</strong> to <code class="docutils literal notranslate"><span class="pre">01-Aug-2012</span> <span class="pre">00:00:00</span></code> and press <strong>Up until now</strong> to change the <strong>Stop Time</strong> to the current time. This will ensure that the search covers all the observation dates from the files we have.</p>
<p>Now press <strong>Start Search</strong>, and you should see the list of observations appear. To save disk sapce, the data in the tutorial materials is incomplete (ie, some observations only have the spectrograph files, others have only some of the SJI files). Navigate through the observations (and their files in the pane below) to find some with SJI files. Use <code class="docutils literal notranslate"><span class="pre">iris_xfiles</span></code> to look at some SJI movies.</p>
<p>Now load the dataset from 2013-12-26 and open the raster file. What can you say about the line list? Make a movie of the Mg II k spectra and explore them. Finally, generate level 3 files, selecting the <code class="docutils literal notranslate"><span class="pre">Si</span> <span class="pre">IV</span> <span class="pre">1403</span></code> and <code class="docutils literal notranslate"><span class="pre">Mg</span> <span class="pre">II</span> <span class="pre">k</span> <span class="pre">2796</span></code> lines. In the next dialog, uncheck all the options. We will use these later with CRISPEX. Note that no <code class="docutils literal notranslate"><span class="pre">sp</span></code> file was created, as these observations comprise only a single 400-step raster.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The profile moments in Line fit is not currently working. You can also explore the data using single or double Gauss fit options, but for this raster doing the Gaussian fits may take between 30-60 minutes, depending on your laptop.</p>
</div>
</div>
<div class="section" id="mg-ii-dopplergrams">
<h2>3.2. Mg II Dopplergrams<a class="headerlink" href="#mg-ii-dopplergrams" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we are going to produce a Dopplergram for the Mg II k line from an IRIS 400-step raster. The Dopplergram is obtained by subtracting the intensities at symmetrical velocity shifts from the line core (e.g. ±50 km/s). For this kind of analysis we need a consistent wavelength calibration for each step of the raster.</p>
<p>We will use the dataset from 2014-11-07. Feel free to examine these data in <code class="docutils literal notranslate"><span class="pre">iris_xfiles</span></code>. This very large dense raster took more than three hours to complete the 400 scans (30 s exposures), which means that the orbital velocity and thermal drifts were changed during the observations. Any precise wavelength calibration will need to correct for those shifts. In most cases, level 2 data have already been corrected for these shifts, but this example shows a dataset for which the automatic calibration still left a residual shift that we must correct for.</p>
<p>First lets load the data using the IDL object interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;iris_l2_20140708_114109_3824262996_raster_t000_r00000.fits&#39;</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">iris_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Let us see the lines that are saved in this raster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">show_lines</span>
<span class="n">Spectral</span> <span class="n">regions</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span>
<span class="mi">0</span>   <span class="mf">1335.71</span>   <span class="n">C</span> <span class="n">II</span> <span class="mi">1336</span>
<span class="mi">1</span>   <span class="mf">1349.43</span>   <span class="n">Fe</span> <span class="n">XII</span> <span class="mi">1349</span>
<span class="mi">2</span>   <span class="mf">1355.60</span>   <span class="n">O</span> <span class="n">I</span> <span class="mi">1356</span>
<span class="mi">3</span>   <span class="mf">1393.78</span>   <span class="n">Si</span> <span class="n">IV</span> <span class="mi">1394</span>
<span class="mi">4</span>   <span class="mf">1402.77</span>   <span class="n">Si</span> <span class="n">IV</span> <span class="mi">1403</span>
<span class="mi">5</span>   <span class="mf">2832.70</span>   <span class="mi">2832</span>
<span class="mi">6</span>   <span class="mf">2814.43</span>   <span class="mi">2814</span>
<span class="mi">7</span>   <span class="mf">2796.20</span>   <span class="n">Mg</span> <span class="n">II</span> <span class="n">k</span> <span class="mi">2796</span>
</pre></div>
</div>
<p>Let us load the Mg II k line into memory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">wave</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">getlam</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">getvar</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">/</span><span class="n">load</span><span class="p">)</span>
</pre></div>
</div>
<p>We can see how the the spatially averaged spectrum looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">mspec</span> <span class="o">=</span> <span class="n">total</span><span class="p">(</span><span class="n">total</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">plot</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">mspec</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">plot</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">mspec</span><span class="p">,</span> <span class="n">xrange</span><span class="o">=</span><span class="p">[</span><span class="mi">2794</span><span class="p">,</span> <span class="mi">2799</span><span class="p">],</span> <span class="o">/</span><span class="n">xst</span>
</pre></div>
</div>
<p>To better understand the orbital velocity problem let us look at how the line intensity varies for a strong Mn I line at around 280.2 nm, in between the Mg II k and h lines. For this dataset, the line core of this line falls around index 350. To plot it in the correct orientation we will make use of IDL’s <code class="docutils literal notranslate"><span class="pre">rotate</span></code>, and the procedure <code class="docutils literal notranslate"><span class="pre">pih</span></code> (available in the IRIS tree of solarsoft) to make the plot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">pih</span><span class="p">,</span> <span class="n">rotate</span><span class="p">(</span><span class="n">reform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]),</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.1667</span><span class="p">]</span>
</pre></div>
</div>
<p>The result should look like this:</p>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="_images/spic_wave1.png"><img alt="_images/spic_wave1.png" src="_images/spic_wave1.png" style="width: 435.2px; height: 532.9499999999999px;" /></a>
<p class="caption"><span class="caption-text">Intensity at Mn I 280.2 nm line when orbital velocity and thermal drifts are <strong>not</strong> fully accounted for.</span></p>
</div>
<p>You can see that the left side of the figure is brighter, and indication that its intensities are not taken at the same position in the line because of wavelength shifts.</p>
<p>To calculate the wavelength shifts from the orbital velocity and thermal drifts we do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">wavecorr</span> <span class="o">=</span> <span class="n">iris_prep_wavecorr_l2</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>This routine measures the wavelength position of 5 neutral lines (3 NUV, 2 FUV) whose rest wavelengths are reasonably well known, and saves the shifts (in Ångström) into the structure variable called <code class="docutils literal notranslate"><span class="pre">wavecorr</span></code>.</p>
<p>The wavelength shift in the i-th line in the j-th frame of the k-th input file is stored in <code class="docutils literal notranslate"><span class="pre">wavecorr.corrs[k,</span> <span class="pre">j,</span> <span class="pre">i]</span></code> . Averaged and smoothed corrections for the NUV and FUV are stored in <code class="docutils literal notranslate"><span class="pre">corr_nuv</span></code> and <code class="docutils literal notranslate"><span class="pre">corr_fuv</span></code>. To plot the per-frame measured wavelength shift and the smoothed correction in the NUV and FUV one would do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">utplot</span><span class="p">,</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">corrs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">psym</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">chars</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;NUV&#39;</span><span class="p">,</span> <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;Wavelength shift [A]&#39;</span><span class="p">,</span> <span class="o">/</span><span class="n">xst</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">outplot</span><span class="p">,</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">corr_nuv</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">thick</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="figure" id="id2">
<img alt="_images/orbitvar_corr2.png" src="_images/orbitvar_corr2.png" />
<p class="caption"><span class="caption-text">Fit to the orbital velocity/thermal shifts from <code class="docutils literal notranslate"><span class="pre">iris_prep_wavecorr_l2</span></code>. Your colours may appear different from this figure, depending on which color table you loaded.</span></p>
</div>
<p>To look at intensities at any given scan we only need to subtract this shift from the wavelength scale, but to look at the whole image at a given wavelength we must interpolate the original data to take this shift into account. Here is a way to do it (note that array dimensions apply to this specific set only!):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">new_data</span> <span class="o">=</span> <span class="n">fltarr</span><span class="p">(</span><span class="mi">537</span><span class="p">,</span> <span class="mi">1095</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="o">/</span><span class="n">n</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="p">;</span> <span class="n">subtract</span> <span class="n">mean</span> <span class="n">shift</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">corr_nuv</span> <span class="o">=</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">corr_nuv</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">wavecorr</span><span class="o">.</span><span class="n">corr_nuv</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">r</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">399</span> <span class="n">do</span> <span class="n">begin</span>
   <span class="k">for</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1094</span> <span class="n">do</span> <span class="n">begin</span>
       <span class="n">new_data</span><span class="p">[</span><span class="o">*</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpol</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">*</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">wave</span> <span class="o">+</span> <span class="n">wavecorr</span><span class="o">.</span><span class="n">corr_nuv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">wave</span><span class="p">)</span>
   <span class="n">endfor</span>
<span class="n">endfor</span>
<span class="n">end</span>
</pre></div>
</div>
<p>(This double loop will take a while to complete.)</p>
<p>Once you have the calibrated data, we can compare again how it looks at the Mn I line wavelength:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">pih</span><span class="p">,</span> <span class="n">rotate</span><span class="p">(</span><span class="n">reform</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]),</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.1667</span><span class="p">]</span>
</pre></div>
</div>
<p>And now we can see that the intensity map is uniform along the solar disk:</p>
<div class="figure" id="id3">
<a class="reference internal image-reference" href="_images/spic_wave2.png"><img alt="_images/spic_wave2.png" src="_images/spic_wave2.png" style="width: 435.2px; height: 532.9499999999999px;" /></a>
<p class="caption"><span class="caption-text">Intensity at Mn I 280.2 nm line when orbital velocity and thermal drifts are accounted for.</span></p>
</div>
<p>We can use this calibrated data for example to calculate dopplergrams. A dopplergram is the difference between the intensities at two wavelength positions at the same (and opposite) distance from the line core. For example, at +/- 50 km/s from the Mg II k3 core. To do this, let us first calculate a velocity scale for the k line and find the indices of the -50 and +50 km/s velocity positions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">k_centre</span> <span class="o">=</span> <span class="mf">2796.3521</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">vel</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_centre</span> <span class="o">-</span> <span class="n">wave</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3e5</span> <span class="o">/</span> <span class="n">k_centre</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="p">;</span> <span class="n">find</span> <span class="n">approximate</span> <span class="n">index</span> <span class="n">of</span> <span class="o">-</span><span class="mi">50</span> <span class="ow">and</span> <span class="mi">50</span> <span class="n">km</span><span class="o">/</span><span class="n">s</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">vel</span> <span class="o">-</span> <span class="mi">50</span><span class="p">),</span> <span class="n">i50p</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">vel</span> <span class="o">+</span> <span class="mi">50</span><span class="p">),</span> <span class="n">i50m</span><span class="p">)</span>
</pre></div>
</div>
<p>Now get the dopplergram and plot it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">doppgr</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">reform</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="n">i50m</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]</span> <span class="o">-</span> <span class="n">new_data</span><span class="p">[</span><span class="n">i50p</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">pih</span><span class="p">,</span> <span class="n">doppgr</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.1667</span><span class="p">]</span>
</pre></div>
</div>
<div class="figure" id="id4">
<a class="reference internal image-reference" href="_images/spic_dopp.png"><img alt="_images/spic_dopp.png" src="_images/spic_dopp.png" style="width: 435.2px; height: 532.9499999999999px;" /></a>
<p class="caption"><span class="caption-text">Dopplegram for Mg II k at +/- 50 km/s.</span></p>
</div>
</div>
<div class="section" id="crispex">
<h2>3.3. CRISPEX<a class="headerlink" href="#crispex" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The version of CRISPEX in the reduced version of SolarSoft we provide has a bug and fails with 400-step rasters. Please download the <a class="reference external" href="http://folk.uio.no/gregal/crispex/code/latest/crispex_v1.7.4.13.tar.gz">latest version of CRISPEX</a> , and unpack the tar file into the correct directory by doing: <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">zxvf</span> <span class="pre">crispex_v1.7.4.13.tar.gz</span> <span class="pre">-C</span> <span class="pre">~/iris9/ssw/iris/idl/uio/</span></code>.</p>
</div>
<div class="section" id="active-region-400-step-raster">
<h3>3.3.1. Active region 400-step raster<a class="headerlink" href="#active-region-400-step-raster" title="Permalink to this headline">¶</a></h3>
<p>Let us go back to the first dataset we worked with, and run CRISPEX on the level 3 file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">crispex</span><span class="p">,</span> <span class="s1">&#39;iris_l3_20131226_171752_3840007146_t000_SiIV1403_MgIIk2796_im.fits&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you haven’t created the level 3 file with <code class="docutils literal notranslate"><span class="pre">iris_xfiles</span></code>, you can create it quickly
from the IDL command line (assuming you are at the directory with the level 2 files):</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s1">&#39;iris_l2_20131226*raster*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">iris_make_fits_level3</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Explore the dataset with CRISPEX, and go through the following tasks/questions:</p>
<ul class="simple">
<li>Adjust the scaling of the spectral plot so that the lines are visible (<cite>Displays</cite> tab, lower/upper y-values, and also multipliers in <cite>Scaling</cite> tab under <cite>Detailed spectrum</cite>)</li>
<li>Look at the main image in the cores of the Mg II k and Si IV lines. Adjust scaling for Si IV 1403 so that it becomes visible (change <cite>Histogram optimisation</cite> to 0.001 and/or set gamma lower than 1)</li>
<li>Blink the image between the spectral positions of the cores of the  Si IV and Mg II k lines (use animation speed of about 2 frames/s)</li>
<li>Can you find a large dot where Si IV is greatly enhanced but Mg II is not too unusual? What are its solar (x, y) coordinates?</li>
<li>Is there a sunspot or a pore in these observations? How do you find out?</li>
</ul>
</div>
<div class="section" id="flare-4-step-raster">
<h3>3.3.2. Flare 4-step raster<a class="headerlink" href="#flare-4-step-raster" title="Permalink to this headline">¶</a></h3>
<p>Now let us look at a different type of IRIS observation, a 4-step dense raster with 80 repeats during which a flare was caught. First, we need to produce the level 3 files for this dataset, so let us do that from IDL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s1">&#39;iris_l2_20141107*raster*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="p">;</span> <span class="n">make</span> <span class="n">level</span> <span class="mi">3</span> <span class="n">files</span> <span class="k">with</span> <span class="n">C</span> <span class="n">II</span><span class="p">,</span> <span class="n">Si</span> <span class="n">IV</span><span class="p">,</span> <span class="ow">and</span> <span class="n">Mg</span> <span class="n">II</span> <span class="p">(</span><span class="n">indices</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">iris_make_fits_level3</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="o">/</span><span class="n">sp</span>
</pre></div>
</div>
<p>Let us now run CRISPEX using both im and sp files, and also use a slit-jaw image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="n">l3files</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s1">&#39;iris_l3_20141107*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">sji</span> <span class="o">=</span> <span class="n">iris_files</span><span class="p">(</span><span class="s1">&#39;iris_l2_20141107*SJI*&#39;</span><span class="p">)</span>
<span class="n">IDL</span><span class="o">&gt;</span> <span class="n">crispex</span><span class="p">,</span> <span class="n">l3files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l3files</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sjicube</span><span class="o">=</span><span class="n">sji</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>When CRISPEX opens, you can see multiple windows, including the slit-jaw image with the 4 raster positions superimposed.</p>
<p>In CRISPEX the visualisation of this dataset has both a time domain and a main image with 16 columns. Feel free to explore this dataset, first by creating the level 3 files and loading them in CRISPEX. When used with a <code class="docutils literal notranslate"><span class="pre">sjicube</span></code> option, one can see the 4 positions superimposed in the slit-jaw image.</p>
<p>Explore the dataset with CRISPEX, and go through the following tasks/questions:</p>
<ul class="simple">
<li>Start running the time sequence. At what time does this observation finish?</li>
<li>Is there a sympathetic flare in the same region?</li>
<li>Adjust the slit-jaw image scaling so you can see more than the flare ribbons</li>
<li>At frame 48, the slit-jaw image overall intensity gets much lower. Why is that?</li>
<li>Show only the Mg II lines (<cite>Diagnostics</cite> tab, unselect other lines and then <cite>Spectral</cite> tab, narrow down Doppler minimum/maximum values)</li>
<li>Lock the mouse at a given position, see how the temporal evolution goes through the <cite>Spectral T-slice</cite> window</li>
<li>Can you find a location with the Mg II triplet lines in emission?</li>
</ul>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorials_python.html" class="btn btn-neutral float-right" title="4. Python Tutorials"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tut_prep.html" class="btn btn-neutral" title="2. Tutorial preparation"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>